<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Heliumkit by tanis2000</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Heliumkit</h1>
        <h2>HeliumKit, a lightweight framework that sits between your web services and the business logic of your app</h2>
        <a href="https://github.com/tanis2000/HeliumKit" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">
          <h1>
<a id="heliumkit" class="anchor" href="#heliumkit" aria-hidden="true"><span class="octicon octicon-link"></span></a>HeliumKit</h1>

<h2>
<a id="about" class="anchor" href="#about" aria-hidden="true"><span class="octicon octicon-link"></span></a>About</h2>

<p>HeliumKit is a lightweight framework that sits between your web services and the business logic of your app.</p>

<p><strong>WARNING!</strong> HeliumKit is still in <strong>alpha</strong> version and API might change any time.</p>

<p>It provides basic mapping to automate conversion from DTO coming from your web services into object models of your business domain. We decided to streamline the process by adopting some libraries and frameworks:</p>

<ul>
<li>
<a href="https://github.com/mxcl/PromiseKit">PromiseKit</a> to manage all the async code</li>
<li>
<a href="https://github.com/ccgus/fmdb">FMDB</a> to store data in SQLite</li>
<li>
<a href="https://github.com/Mantle/Mantle">Mantle</a> to convert models to and from JSON representation</li>
<li>
<a href="https://github.com/tanis2000/MTLFMDBAdapter">MTLFMDBAdapter</a> to convert models into SQL statements to feed to FMDB</li>
<li>
<a href="https://github.com/AFNetworking/AFNetworking">AFNetworking</a> to manage web service API calls</li>
</ul>

<p>The main focus is to keep this framework as lightweight as possible and at the same time make it flexible enough for you to craft the perfect solution to your data transfer and storage layer. Many ideas come from RestKit as I've been using that framework for commercial apps before. But I've never been fond of Core Data as the storage architecture. I'm way too used to good old SQL statements and I can't live with the threading issues that you have to fight against when using Core Data. Core Data is great, but it's not for me.</p>

<p>HeliumKit can simply keep your data in in-memory models or it can write them to SQLite as needed. That's completely configurable. I tried to keep in mind the convention over configuration paradigm as I hate boilerplate code.
I hope you find this framework just as useful as I do. Contributions and pull requests are welcome!</p>

<h2>
<a id="introduction" class="anchor" href="#introduction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Introduction</h2>

<p>HeliumKit is pretty much the result of my frustration with other REST mapping frameworks and Core Data. The article <a href="http://www.objc.io/issue-4/SQLite-instead-of-core-data.html">On Using SQLite and FMDB Instead of Core Data</a> by <a href="http://inessential.com/">Brent Simmons</a> sums up what I think about Core Data and why I try to avoid using it whenever possible. I've also drawn inspiration from that article to come up with the <a href="https://github.com/tanis2000/HeliumKit/blob/develop/Pod/Classes/Database/ALTDatabaseController.h">ALTDatabaseController</a> class. </p>

<h2>
<a id="quick-start" class="anchor" href="#quick-start" aria-hidden="true"><span class="octicon octicon-link"></span></a>Quick start</h2>

<p>Here's a quick example of what you can do with HeliumKit.</p>

<h3>
<a id="your-first-data-provider" class="anchor" href="#your-first-data-provider" aria-hidden="true"><span class="octicon octicon-link"></span></a>Your first data provider</h3>

<p>Create a new provider to read the repository of my user from GitHub. The first thing to do is to create the model:</p>

<p>ALTGHRepo.h</p>

<div class="highlight highlight-obj-c"><pre>#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">"</span>MTLModel.h<span class="pl-pds">"</span></span>
#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">&lt;</span>Mantle/MTLJSONAdapter.h<span class="pl-pds">&gt;</span></span>
#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">&lt;</span>MTLFMDBAdapter/MTLFMDBAdapter.h<span class="pl-pds">&gt;</span></span>

<span class="pl-k">@interface</span> <span class="pl-en">ALTGHRepo</span> : <span class="pl-e">MTLModel</span>&lt;MTLJSONSerializing, MTLFMDBSerializing&gt;

<span class="pl-k">@property</span> (<span class="pl-k">nonatomic</span>, <span class="pl-k">copy</span>) <span class="pl-c1">NSNumber</span> *repoId;
<span class="pl-k">@property</span> (<span class="pl-k">nonatomic</span>, <span class="pl-k">copy</span>) <span class="pl-c1">NSString</span> *repoName;
<span class="pl-k">@property</span> (<span class="pl-k">nonatomic</span>, <span class="pl-k">copy</span>) <span class="pl-c1">NSString</span> *repoUrl;

<span class="pl-k">@end</span></pre></div>

<p>ALTGHRepo.m</p>

<div class="highlight highlight-obj-c"><pre>#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">"</span>ALTGHRepo.h<span class="pl-pds">"</span></span>

<span class="pl-k">@implementation</span> <span class="pl-en">ALTGHRepo</span>

+(<span class="pl-c1">NSDictionary</span> *)<span class="pl-en">JSONKeyPathsByPropertyKey</span> {
    <span class="pl-k">return</span> @{
             <span class="pl-s"><span class="pl-pds">@"</span>repoId<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">@"</span>id<span class="pl-pds">"</span></span>,
             <span class="pl-s"><span class="pl-pds">@"</span>repoName<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">@"</span>name<span class="pl-pds">"</span></span>,
             <span class="pl-s"><span class="pl-pds">@"</span>repoUrl<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">@"</span>url<span class="pl-pds">"</span></span>,
             };
}

+(<span class="pl-c1">NSDictionary</span> *)<span class="pl-en">FMDBColumnsByPropertyKey</span> {
    <span class="pl-k">return</span> @{
             <span class="pl-s"><span class="pl-pds">@"</span>repoId<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">@"</span>id<span class="pl-pds">"</span></span>,
             <span class="pl-s"><span class="pl-pds">@"</span>repoName<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">@"</span>name<span class="pl-pds">"</span></span>,
             <span class="pl-s"><span class="pl-pds">@"</span>repoUrl<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">@"</span>url<span class="pl-pds">"</span></span>,
             };
}

+(<span class="pl-c1">NSArray</span> *)<span class="pl-en">FMDBPrimaryKeys</span> {
    <span class="pl-k">return</span> @[<span class="pl-s"><span class="pl-pds">@"</span>id<span class="pl-pds">"</span></span>];
}

+(<span class="pl-c1">NSString</span> *)<span class="pl-en">FMDBTableName</span> {
    <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">@"</span>ghrepo<span class="pl-pds">"</span></span>;
}
<span class="pl-k">@end</span></pre></div>

<p>Next you need to create the provider itself:</p>

<p>ALTGHRepoProvider.h</p>

<div class="highlight highlight-obj-c"><pre>#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">"</span>ALTBaseProvider.h<span class="pl-pds">"</span></span>

<span class="pl-k">@interface</span> <span class="pl-en">ALTGHRepoProvider</span> : <span class="pl-e">ALTBaseProvider</span>

<span class="pl-k">@end</span></pre></div>

<p>ALTGHRepoProvider.m</p>

<div class="highlight highlight-obj-c"><pre>#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">"</span>ALTGHRepoProvider.h<span class="pl-pds">"</span></span>
#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">"</span>ALTGHRepo.h<span class="pl-pds">"</span></span>
#<span class="pl-k">import</span> <span class="pl-s"><span class="pl-pds">&lt;</span>HeliumKit/ALTObjectMapping.h<span class="pl-pds">&gt;</span></span>

<span class="pl-k">@implementation</span> <span class="pl-en">ALTGHRepoProvider</span>

- (<span class="pl-c1">NSString</span> *)<span class="pl-en">endPoint</span> {
    <span class="pl-k">return</span> [<span class="pl-c1">NSString</span> <span class="pl-c1">stringWithFormat:</span><span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%@%@</span><span class="pl-pds">"</span></span>, <span class="pl-v">self</span>.baseURL, <span class="pl-s"><span class="pl-pds">@"</span>/users/tanis2000/repos<span class="pl-pds">"</span></span>];
}

- (PMKPromise *)<span class="pl-en">fetchObjectsFromDb</span> {
    <span class="pl-k">return</span> [PMKPromise <span class="pl-c1">new:</span>^(PMKPromiseFulfiller fulfiller, PMKPromiseRejecter rejecter) {
        <span class="pl-k">if</span> (!self.<span class="pl-smi">skipDatabase</span>) {
            [<span class="pl-v">self</span>.database <span class="pl-c1">fetch:</span><span class="pl-s"><span class="pl-pds">@"</span>ghrepo<span class="pl-pds">"</span></span> <span class="pl-c1">returnClass:</span>ALTGHRepo.class].<span class="pl-c1">then</span>(^(<span class="pl-k">id</span> res) {
                <span class="pl-c1">fulfiller</span>(res);
            });
        } <span class="pl-k">else</span> {
            <span class="pl-c1">fulfiller</span>(<span class="pl-c1">nil</span>);
        }
    }];
}

- (<span class="pl-c1">NSArray</span> *)<span class="pl-en">objectMappings</span> {
    ALTObjectMapping *mapping = [ALTObjectMapping <span class="pl-c1">mappingForModel:</span>ALTGHRepo.class <span class="pl-c1">sourcePath:</span><span class="pl-c1">nil</span>];

    <span class="pl-k">return</span> @[mapping];
}</pre></div>

<p>To test this, add the following code to your business logic layer:</p>

<div class="highlight highlight-obj-c"><pre>ALTDatabaseController *_database;
AFHTTPRequestOperationManager *_manager;

_manager = [AFHTTPRequestOperationManager <span class="pl-c1">manager</span>];
_manager.responseSerializer = [AFJSONResponseSerializer <span class="pl-c1">serializer</span>];
_manager.requestSerializer = [AFJSONRequestSerializer <span class="pl-c1">serializer</span>];
[_manager.requestSerializer <span class="pl-c1">setValue:</span><span class="pl-s"><span class="pl-pds">@"</span>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_9_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/32.0.1700.102 Safari/537.36<span class="pl-pds">"</span></span> <span class="pl-c1">forHTTPHeaderField:</span><span class="pl-s"><span class="pl-pds">@"</span>User-Agent<span class="pl-pds">"</span></span>];
[_manager.requestSerializer <span class="pl-c1">setValue:</span><span class="pl-s"><span class="pl-pds">@"</span>application/json<span class="pl-pds">"</span></span> <span class="pl-c1">forHTTPHeaderField:</span><span class="pl-s"><span class="pl-pds">@"</span>Content-Type<span class="pl-pds">"</span></span>];
[_manager.requestSerializer <span class="pl-c1">setValue:</span><span class="pl-s"><span class="pl-pds">@"</span>application/json<span class="pl-pds">"</span></span> <span class="pl-c1">forHTTPHeaderField:</span><span class="pl-s"><span class="pl-pds">@"</span>Accept<span class="pl-pds">"</span></span>];

<span class="pl-c">// Grab the Documents folder</span>
<span class="pl-c1">NSArray</span> *paths = <span class="pl-c1">NSSearchPathForDirectoriesInDomains</span>(NSDocumentDirectory, NSUserDomainMask, <span class="pl-c1">YES</span>);
<span class="pl-c1">NSString</span> *documentsDirectory = [paths <span class="pl-c1">objectAtIndex:</span><span class="pl-c1">0</span>];

<span class="pl-c">// Sets the database filename</span>
<span class="pl-c1">NSString</span> *filePath = [documentsDirectory <span class="pl-c1">stringByAppendingPathComponent:</span><span class="pl-s"><span class="pl-pds">@"</span>Test.sqlite<span class="pl-pds">"</span></span>];

_database = [[ALTDatabaseController <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithDatabasePath:</span>filePath
                                                  <span class="pl-c1">creationBlock:</span>^(FMDatabase *db, <span class="pl-k">BOOL</span> *rollback) {
                                                      [db <span class="pl-c1">executeUpdate:</span><span class="pl-s"><span class="pl-pds">@"</span>create table if not exists ghrepo <span class="pl-pds">"</span></span>
                                                       <span class="pl-s"><span class="pl-pds">"</span>(id text unique, name text, url text)<span class="pl-pds">"</span></span>];
                                                  }];

ALTGHRepoProvider *provider = [[ALTGHRepoProvider <span class="pl-c1">alloc</span>] <span class="pl-c1">initWithDatabaseController:</span>_database <span class="pl-c1">andRequestOperationManager:</span>_manager <span class="pl-c1">andBaseURL:</span><span class="pl-s"><span class="pl-pds">@"</span>https://api.github.com<span class="pl-pds">"</span></span>];
ALTBaseRequest *request = [[ALTBaseRequest <span class="pl-c1">alloc</span>] <span class="pl-c1">init</span>];
provider.request = request;
[provider <span class="pl-c1">fetchData:</span>ALTHTTPMethodGET].then(^(<span class="pl-c1">NSArray</span> *cachedData, PMKPromise *freshData) {
    <span class="pl-c">// cachedData contains data already in the db</span>
    <span class="pl-k">return</span> freshData;
}).then(^(<span class="pl-k">id</span> mappingResult, <span class="pl-c1">NSArray</span> *freshData) {
    <span class="pl-c">// freshData contains the data that has been grabbed from the remote service and saved into the database</span>
    <span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span><span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, freshData);
}).catch(^(<span class="pl-c1">NSError</span> *error) {
    <span class="pl-c1">NSLog</span>(<span class="pl-s"><span class="pl-pds">@"</span>Failed with error: <span class="pl-c1">%@</span><span class="pl-pds">"</span></span>, [error <span class="pl-c1">localizedDescription</span>]);
});
</pre></div>

<h2>
<a id="limitations" class="anchor" href="#limitations" aria-hidden="true"><span class="octicon octicon-link"></span></a>Limitations</h2>

<p>HeliumKit isn't a one-stop-do-it-all solution. It does a few things pretty well but that's all there is to it. This is not a full ORM solution nor is it a complete replacement of Core Data.</p>

<p>What HeliumKit does not do:</p>

<ul>
<li>there's no support for models that are children of other models. The data being loaded from the database is an NSArray of instances of models returned by a SQL query. We're not retrieving associated models. BUT! If you work directly with the data returned by the web service, that data will contain all of the related classes as well.</li>
</ul>

<h2>
<a id="usage" class="anchor" href="#usage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>To run the example project, clone the repo, and run <code>pod install</code> from the Example directory first.</p>

<h2>
<a id="installation" class="anchor" href="#installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation</h2>

<p>HeliumKit is available through <a href="http://cocoapods.org">CocoaPods</a>. To install
it, simply add the following line to your Podfile:</p>

<pre><code>pod "HeliumKit"
</code></pre>

<h2>
<a id="author" class="anchor" href="#author" aria-hidden="true"><span class="octicon octicon-link"></span></a>Author</h2>

<p>Valerio Santinelli, <a href="mailto:santinelli@altralogica.it">santinelli@altralogica.it</a></p>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p>HeliumKit is available under the MIT license. See the LICENSE file for more info.</p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/tanis2000/HeliumKit/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/tanis2000/HeliumKit/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/tanis2000/HeliumKit"></a> is maintained by <a href="https://github.com/tanis2000">tanis2000</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-2312876-12");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
